

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/blog.png">
  <link rel="icon" href="/img/blog.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="Coveyzy blog site">
  <meta name="author" content="Coveyzy">
  <meta name="keywords" content="">
  
  <title>使用permission.pl脚本修复节点文件权限 - Coveyzy</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.6.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.10","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":false,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":6},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"0e72dfeefd44eb1c4e004d18d1d97438","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Coveyzy</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/Hippopx.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="使用permission.pl脚本修复节点文件权限">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Coveyzy
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-07-07 10:58" pubdate>
        2021年7月7日星期三上午10点58分
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      672 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      14
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">使用permission.pl脚本修复节点文件权限</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2 个月前
                
              </p>
            
            <div class="markdown-body">
              <blockquote>
<p><code>Script to capture and restore file permission in a directory (for eg. ORACLE_HOME) (Doc ID 1515018.1)</code></p>
<p>问题描述：RAC两个节点中，在节点2执行了<code>chown -R oracle:oinstall /u01</code> 导致节点2 文件权限不对，集群状态异常</p>
<p>解决办法：通过官方提供的 <code>permission.pl</code> 脚本进行修复</p>
</blockquote>
<ol>
<li>校验节点2权限问题</li>
</ol>
<div class="hljs code-wrapper"><pre><code class="hljs sql"># 校验失败，说明权限有异常
[grid<span class="hljs-variable">@rac2</span> <span class="hljs-operator">~</span>]$ cluvfy comp software <span class="hljs-operator">-</span>n <span class="hljs-keyword">all</span> <span class="hljs-operator">-</span>verbose

Verifying software

<span class="hljs-keyword">Check</span>: Software

<span class="hljs-number">3162</span> files verified

Software <span class="hljs-keyword">check</span> failed

Verification <span class="hljs-keyword">of</span> software was failed.</code></pre></div>



<ol start="2">
<li>1节点执行修复脚本</li>
</ol>
<div class="hljs code-wrapper"><pre><code class="hljs sql"># 以root用户执行.<span class="hljs-operator">/</span>permission.pl <span class="hljs-operator">&lt;</span>Path name <span class="hljs-keyword">to</span> capture permission<span class="hljs-operator">&gt;</span>
[root<span class="hljs-variable">@rac1</span> u01]# .<span class="hljs-operator">/</span>permission.pl <span class="hljs-operator">/</span>u01<span class="hljs-operator">/</span>
.........
Following log files <span class="hljs-keyword">are</span> generated
logfile      : permission<span class="hljs-operator">-</span>Wed<span class="hljs-operator">-</span>Jul<span class="hljs-number">-07</span><span class="hljs-number">-10</span><span class="hljs-number">-21</span><span class="hljs-number">-13</span><span class="hljs-number">-2021</span>
Command file : restore<span class="hljs-operator">-</span>perm<span class="hljs-operator">-</span>Wed<span class="hljs-operator">-</span>Jul<span class="hljs-number">-07</span><span class="hljs-number">-10</span><span class="hljs-number">-21</span><span class="hljs-number">-13</span><span class="hljs-number">-2021.</span>cmd
Linecount : <span class="hljs-number">62264</span>


[root<span class="hljs-variable">@rac1</span> u01]# ls <span class="hljs-operator">-</span>lrt
total <span class="hljs-number">17556</span>
drwxrwxr<span class="hljs-operator">-</span>x. <span class="hljs-number">7</span> grid oinstall     <span class="hljs-number">4096</span> Jan <span class="hljs-number">27</span> <span class="hljs-number">16</span>:<span class="hljs-number">14</span> soft
drwxr<span class="hljs-operator">-</span>xr<span class="hljs-operator">-</span>x  <span class="hljs-number">6</span> root oinstall       <span class="hljs-number">66</span> Jan <span class="hljs-number">28</span> <span class="hljs-number">12</span>:<span class="hljs-number">34</span> app
<span class="hljs-operator">-</span>rwxr<span class="hljs-operator">-</span>xr<span class="hljs-operator">-</span>x  <span class="hljs-number">1</span> root root         <span class="hljs-number">2451</span> Mar <span class="hljs-number">31</span> <span class="hljs-number">18</span>:<span class="hljs-number">08</span> permission.pl
<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>r<span class="hljs-comment">--r--  1 root root     11869417 Jul  7 10:22 restore-perm-Wed-Jul-07-10-21-13-2021.cmd</span>
<span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>r<span class="hljs-comment">--r--  1 root root      6098198 Jul  7 10:22 permission-Wed-Jul-07-10-21-13-2021</span></code></pre></div>

<p>在当前目录下会生成两个文件:</p>
<p>a. <strong>permission-<time stamp></strong> - This contains file permission in octal value, owner and group information of the files captured<br>b. <strong>restore-perm-<time stamp>.cmd</strong> - This contains command to change the permission, owner, and group of the captured files</p>
<ol start="3">
<li>将生成的两个文件拷贝到2节点</li>
</ol>
<div class="hljs code-wrapper"><pre><code class="hljs subunit">[root@rac1 u01]# scp permission-Wed-Jul<span class="hljs-string">-07</span><span class="hljs-string">-09</span><span class="hljs-string">-41</span><span class="hljs-string">-25</span><span class="hljs-string">-2021</span> root@rac2:/u01

[root@rac1 u01]# scp restore-perm-Wed-Jul<span class="hljs-string">-07</span><span class="hljs-string">-09</span><span class="hljs-string">-41</span><span class="hljs-string">-25</span><span class="hljs-string">-2021</span>.cmd root@rac2:/u01/</code></pre></div>



<ol start="4">
<li>修改<code>restore-perm-&lt;time stamp&gt;.cmd</code>中的信息</li>
</ol>
<div class="hljs code-wrapper"><pre><code class="hljs sql"># 需要修改主机名、数据库实例名、ASM实例名
[root<span class="hljs-variable">@rac2</span> u01]$ vi restore<span class="hljs-operator">-</span>perm<span class="hljs-operator">-</span>Wed<span class="hljs-operator">-</span>Jul<span class="hljs-number">-07</span><span class="hljs-number">-09</span><span class="hljs-number">-41</span><span class="hljs-number">-25</span><span class="hljs-number">-2021.</span>cmd

:<span class="hljs-operator">%</span>s<span class="hljs-operator">/</span>rac1<span class="hljs-operator">/</span>rac2<span class="hljs-operator">/</span>g
:<span class="hljs-operator">%</span>s<span class="hljs-operator">/</span>racdb1<span class="hljs-operator">/</span>racdb2<span class="hljs-operator">/</span>g
:<span class="hljs-operator">%</span>s<span class="hljs-operator">/</span>ASM1<span class="hljs-operator">/</span>ASM2<span class="hljs-operator">/</span>g
:<span class="hljs-operator">%</span>s<span class="hljs-operator">/</span>asm1<span class="hljs-operator">/</span>asm2<span class="hljs-operator">/</span>g

# 赋予<span class="hljs-number">755</span>权限
[root<span class="hljs-variable">@rac2</span> u01]# chmod <span class="hljs-number">755</span> restore<span class="hljs-operator">-</span>perm<span class="hljs-operator">-</span>Wed<span class="hljs-operator">-</span>Jul<span class="hljs-number">-07</span><span class="hljs-number">-09</span><span class="hljs-number">-41</span><span class="hljs-number">-25</span><span class="hljs-number">-2021.</span>cmd</code></pre></div>



<ol start="5">
<li>以root用户执行<code>restore-perm-&lt;time stamp&gt;.cmd</code>文件</li>
</ol>
<div class="hljs code-wrapper"><pre><code class="hljs sql">[root<span class="hljs-variable">@rac2</span> u01]# .<span class="hljs-operator">/</span>restore<span class="hljs-operator">-</span>perm<span class="hljs-operator">-</span>Wed<span class="hljs-operator">-</span>Jul<span class="hljs-number">-07</span><span class="hljs-number">-09</span><span class="hljs-number">-41</span><span class="hljs-number">-25</span><span class="hljs-number">-2021.</span>cmd</code></pre></div>

<p>屏幕输出中会有<code>chown</code>和<code>chmod</code>报错，主要原因为一些日志文件不存在引起</p>
<ol start="6">
<li>重启主机或集群</li>
</ol>
<div class="hljs code-wrapper"><pre><code class="hljs sql">[grid<span class="hljs-variable">@rac2</span> <span class="hljs-operator">~</span>]$ crsctl stat res <span class="hljs-operator">-</span>t
<span class="hljs-comment">--------------------------------------------------------------------------------</span>
NAME           TARGET  STATE        SERVER                   STATE_DETAILS
<span class="hljs-comment">--------------------------------------------------------------------------------</span>
<span class="hljs-keyword">Local</span> Resources
<span class="hljs-comment">--------------------------------------------------------------------------------</span>
ora.ARCH.dg
               ONLINE  ONLINE       rac1
               ONLINE  ONLINE       rac2
ora.CRS.dg
               ONLINE  ONLINE       rac1
               ONLINE  ONLINE       rac2
ora.DATA.dg
               ONLINE  ONLINE       rac1
               ONLINE  ONLINE       rac2
ora.LISTENER.lsnr
               ONLINE  ONLINE       rac1
               ONLINE  ONLINE       rac2
ora.asm
               ONLINE  ONLINE       rac1                     Started
               ONLINE  ONLINE       rac2                     Started
ora.gsd
               OFFLINE OFFLINE      rac1
               OFFLINE OFFLINE      rac2
ora.net1.network
               ONLINE  ONLINE       rac1
               ONLINE  ONLINE       rac2
ora.ons
               ONLINE  ONLINE       rac1
               ONLINE  ONLINE       rac2
<span class="hljs-comment">--------------------------------------------------------------------------------</span>
Cluster Resources
<span class="hljs-comment">--------------------------------------------------------------------------------</span>
ora.LISTENER_SCAN1.lsnr
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac1
ora.cvu
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac1
ora.oc4j
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac1
ora.rac1.vip
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac1
ora.rac2.vip
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac2
ora.racdb.db
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac1                     <span class="hljs-keyword">Open</span>
      <span class="hljs-number">2</span>        ONLINE  ONLINE       rac2                     <span class="hljs-keyword">Open</span>
ora.scan1.vip
      <span class="hljs-number">1</span>        ONLINE  ONLINE       rac1
[grid<span class="hljs-variable">@rac2</span> <span class="hljs-operator">~</span>]$</code></pre></div>

<hr>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>权限修复成功的前提是必须有一个节点的权限是正常的，否则无法通过此方式进行修复</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/ORACLE/">ORACLE</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/RAC/">RAC</a>
                    
                      <a class="hover-with-bg" href="/tags/%E4%BF%AE%E5%A4%8D/">修复</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/12/arch-sql/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/05/30/%E5%85%AC%E5%91%8A/">
                        <span class="hidden-mobile">公告</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <span>Coveyzy</span></a> <i class="iconfont icon-love"></i> <span>Gy</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.2/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>





  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0e72dfeefd44eb1c4e004d18d1d97438";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
