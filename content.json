{"meta":{"title":"Coveyzy","subtitle":null,"description":"Coveyzy blog site","author":"Coveyzy","url":"http://coveyzy.vip","root":"/"},"pages":[{"title":"About me","date":"2021-08-24T01:56:11.124Z","updated":"2021-08-24T01:56:11.106Z","comments":false,"path":"about/index.html","permalink":"http://coveyzy.vip/about/index.html","excerpt":"","text":"Hold on ~ I will show you my error ! WeChat - Coveyzy QQ - 740569787"},{"title":"分类","date":"2021-08-23T15:55:50.555Z","updated":"2021-08-23T15:55:50.555Z","comments":false,"path":"categories/index.html","permalink":"http://coveyzy.vip/categories/index.html","excerpt":"","text":""},{"title":"书单","date":"2021-08-23T15:55:50.554Z","updated":"2021-08-23T15:55:50.554Z","comments":false,"path":"books/index.html","permalink":"http://coveyzy.vip/books/index.html","excerpt":"","text":""},{"title":"友情链接","date":"2021-08-23T15:55:50.555Z","updated":"2021-08-23T15:55:50.555Z","comments":true,"path":"links/index.html","permalink":"http://coveyzy.vip/links/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2021-08-23T15:55:50.556Z","updated":"2021-08-23T15:55:50.556Z","comments":false,"path":"repository/index.html","permalink":"http://coveyzy.vip/repository/index.html","excerpt":"","text":""},{"title":"404 Not Found：该页无法显示","date":"2021-08-23T15:55:50.550Z","updated":"2021-08-23T15:55:50.550Z","comments":false,"path":"/404.html","permalink":"http://coveyzy.vip/404.html","excerpt":"","text":""},{"title":"标签","date":"2021-08-23T15:55:50.556Z","updated":"2021-08-23T15:55:50.556Z","comments":false,"path":"tags/index.html","permalink":"http://coveyzy.vip/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"通过RMAN方式搭建Oracle 10G DataGuard","slug":"2021-08-23-通过RMAN方式搭建Oracle-10G-DataGuard","date":"2021-08-23T06:46:38.000Z","updated":"2021-08-24T08:13:12.886Z","comments":true,"path":"2021/08/23/2021-08-23-通过RMAN方式搭建Oracle-10G-DataGuard/","link":"","permalink":"http://coveyzy.vip/2021/08/23/2021-08-23-%E9%80%9A%E8%BF%87RMAN%E6%96%B9%E5%BC%8F%E6%90%AD%E5%BB%BAOracle-10G-DataGuard/","excerpt":"","text":"通过RMAN方式搭建Oracle 10G DataGuard 如有错误之处，恳请指正。 步骤总结 standby系统配置 打包软件并拷贝 解压后的操作 主库参数修改及备份 备库参数修改及还原 开启日志应用 问题处理 环境说明primary： ​ version：Oracle 10g 10.2.0.3 ​ instance_name：member ​ db_unique_name：MEMSTD2 ​ OS：CentOS 5.6 standby: ​ version：Oracle 10g 10.2.0.3 ​ instance_name：memberdg ​ db_unique_name：MEMBERDG ​ OS：CentOS 5.6 standby配置 操作系统参数调整 略。正常配置即可。 添加用户和组 groupadd oinstall groupadd dba useradd -g oinstall -G dba oracle passwd oracle 修改.bash_profile 从primary拷贝过来 scp ~/.bash_profile standby:$PWD 也可手动修改 打包软件并拷贝 打包软件 tar -zcpf oracle.tar.gz /oracle 传输文件 scp oracle.tar.gz standby:/data/software 解压软件 tar -zxf oracle.tar.gz -C /oracle 权限管理 打包文件本身包含了权限，如果有问题也可以手动修改 chown -R oracle:oinstall /oracle 执行脚本 oralce用户下执行： relink all sh $ORACLE_HOME/install/changePerm.sh root用户下执行： sh $ORACLE_HOME/root.sh 主库参数修改及备份下列操作如未特别说明，默认在主库操作 开启强制日志记录 保证DataGuard的可恢复性，强制数据库在任何状态下都必须记录日志 1234select force_logging from v$database;-- 返回值为NO，则执行该语句开启alter database force logging; 修改参数文件 1234ALTER SYSTEM SET LOG_ARCHIVE_CONFIG=&#x27;DG_CONFIG=(MEMSTD2,MEMBERDG)&#x27;;ALTER SYSTEM SET LOG_ARCHIVE_DEST_2=&#x27;SERVICE=MEMBERDG LGWR ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLES) DB_UNIQUE_NAME=MEMBERDG&#x27;;ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_1=ENABLE;ALTER SYSTEM SET LOG_ARCHIVE_DEST_STATE_2=ENABLE; 修改tnsnames.ora配置 1234567891011121314151617181920-- 添加以下内容MEMBER = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = primary)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = member1) ) )MEMBERDG = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = standby)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = memberdg) ) ) 创建standby redo log 建议比online redo log多一组，size相同 1234567alter database add standby logfile group 21 (&#x27;/data/memberdg/std_log_2101.log&#x27;) size 500m;alter database add standby logfile group 22 (&#x27;/data/memberdg/std_log_2201.log&#x27;) size 500m;alter database add standby logfile group 23 (&#x27;/data/memberdg/std_log_2301.log&#x27;) size 500m;alter database add standby logfile group 24 (&#x27;/data/memberdg/std_log_2401.log&#x27;) size 500m;alter database add standby logfile group 25 (&#x27;/data/memberdg/std_log_2501.log&#x27;) size 500m;alter database add standby logfile group 26 (&#x27;/data/memberdg/std_log_2601.log&#x27;) size 500m;alter database add standby logfile group 27 (&#x27;/data/memberdg/std_log_2701.log&#x27;) size 500m; 使用rman备份主库 123456789101112131415161718192021rman target /run&#123; allocate channel ch1 device type disk; allocate channel ch2 device type disk; allocate channel ch3 device type disk; allocate channel ch4 device type disk; allocate channel ch5 device type disk; allocate channel ch6 device type disk; allocate channel ch7 device type disk; allocate channel ch8 device type disk; backup DATABASE include CURRENT controlfile format &#x27;/data1/backup/member_%d_%T_%s_%p&#x27;; release channel ch1; release channel ch2; release channel ch3; release channel ch4; release channel ch5; release channel ch6; release channel ch7; release channel ch8;&#125; 拷贝备份文件至standby scp /data1/backup/* standby:$PWD 备库参数修改及还原下列操作如未特别说明，默认在主库操作 参数文件配置 在primary生成pfile参数文件 1create pfile = &#x27;/data1/backup/pfile.ora&#x27; from spfile; 拷贝至standby scp /data1/backup/pfile.ora standby:/data/backup/ standby生成spfile文件 1create spfile from pfile = &#x27;/data/backup/pfile.ora&#x27;; 手动创建参数文件中指定的audit_file_dest、background_dump_dest、core_dump_dest、db_recovery_file_dest、user_dump_dest等目录 启动实例至nomount 1startup nomount 修改备库参数 12345678alter system set db_unique_name = memberdg scope=spfile;alter system set log_archive_config=&#x27;DG_CONFIG=(MEMSTD2,MEMBERDG)&#x27;;alter system set LOG_ARCHIVE_DEST_2=&#x27;SERVICE=MEMSTD2 LGWR ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=MEMSTD2&#x27;;alter system set LOG_ARCHIVE_DEST_STATE_1=ENABLE;alter system set LOG_ARCHIVE_DEST_STATE_2=DEFER;alter system set remote_login_passwordfile=&#x27;EXCLUSIVE&#x27; scope=spfile;alter system set DB_FILE_NAME_CONVERT=&#x27;/data/member/&#x27;,&#x27;/data/memberdg/&#x27;,&#x27;/data1/member/&#x27;,&#x27;/data/memberdg/&#x27; scope=spfile;alter system set LOG_FILE_NAME_CONVERT=&#x27;/data/member/&#x27;,&#x27;/data/memberdg/&#x27;,&#x27;/data1/member/&#x27;,&#x27;/data/memberdg/&#x27; scope=spfile; shutdown 配置控制文件 primary执行 1alter database create standby controlfile as &#x27;/data1/backup/ctl.bak&#x27;; scp /data1/backup/ctl.bak standby:/data/backup/ 备库将该文件拷贝至对应目录并改名 将备库起到mount状态 1startup mount 使用rman进行还原 1234567891011121314151617181920212223rman target /catalog start with &#x27;/data/backup/&#x27;;run&#123; allocate channel ch1 device type disk; allocate channel ch2 device type disk; allocate channel ch3 device type disk; allocate channel ch4 device type disk; allocate channel ch5 device type disk; allocate channel ch6 device type disk; allocate channel ch7 device type disk; allocate channel ch8 device type disk; restore database; release channel ch1; release channel ch2; release channel ch3; release channel ch4; release channel ch5; release channel ch6; release channel ch7; release channel ch8;&#125; 创建standby redo log 1234567alter database add standby logfile group 21 (&#x27;/data/memberdg/std_log_2101.log&#x27;) size 500m;alter database add standby logfile group 22 (&#x27;/data/memberdg/std_log_2201.log&#x27;) size 500m;alter database add standby logfile group 23 (&#x27;/data/memberdg/std_log_2301.log&#x27;) size 500m;alter database add standby logfile group 24 (&#x27;/data/memberdg/std_log_2401.log&#x27;) size 500m;alter database add standby logfile group 25 (&#x27;/data/memberdg/std_log_2501.log&#x27;) size 500m;alter database add standby logfile group 26 (&#x27;/data/memberdg/std_log_2601.log&#x27;) size 500m;alter database add standby logfile group 27 (&#x27;/data/memberdg/std_log_2701.log&#x27;) size 500m; 修改tnsnames.ora 12345678910111213141516171819MEMBER = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = primary)(PORT = 1521)) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = member1) ) )MEMBERDG = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = standby)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = memberdg) ) ) 开启force logging 123select force_logging from v$database;alter database force logging; 添加静态监听 12345678SID_LIST_LISTENER = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = MEMBERDG) (ORACLE_HOME = /oracle/app/product/10.0.2/db_1) (SID_NAME = memberdg) )) 开启日志应用 tnsping检查主备通信 12tnsping primarytnsping standby 备库开启日志应用 1alter database recover managed standby database using current logfile disconnect from session ; 检查应用情况 1234-- 检查alert日志-- 检查进程select process,status,sequence#,block# from gv$managed_standby; 问题处理 alert日志报错如下： 解决办法： 如果设置有fal_client和fal_server参数，DG会自动寻找缺失的日志，前提是日志文件没被覆盖或归档文件还在。 这里因为归档已经不在了，只能通过基于SCN的增量备份后进行恢复，具体步骤如下： （1）确定SCN 12345-- 执行以下语句，哪个值小就从哪个开始增备select min(first_nonlogged_scn) from v$datafile where first_nonlogged_scn &gt; 0;-- 可能不会有返回值，则以下面的返回值为开始SCNselect current_scn from v$database; （2）主库执行增量备份 1234backup incremental from scn 48310199829 database format &#x27;/data1/backup/archivedlog_%U&#x27;;-- 备份控制文件backup current controlfile for standby format &#x27;/data1/backup/controlfile.bak&#x27;; （3）恢复数据库 123recover database noredo;restore standby controlfile from &#x27;/data/backup/controlfile.bak&#x27;; （4）重新开启日志应用 备库需要手动创建standby redo log 还有一些小问题，没有及时记录，就不bb了。","categories":[{"name":"DataGuard","slug":"DataGuard","permalink":"http://coveyzy.vip/categories/DataGuard/"}],"tags":[{"name":"Oracle DataGuard","slug":"Oracle-DataGuard","permalink":"http://coveyzy.vip/tags/Oracle-DataGuard/"}]},{"title":"使用permission.pl脚本修复节点文件权限","slug":"2021-07-07-使用permission-pl脚本修复节点文件权限","date":"2021-07-07T02:58:22.000Z","updated":"2021-07-07T03:01:16.000Z","comments":true,"path":"2021/07/07/2021-07-07-使用permission-pl脚本修复节点文件权限/","link":"","permalink":"http://coveyzy.vip/2021/07/07/2021-07-07-%E4%BD%BF%E7%94%A8permission-pl%E8%84%9A%E6%9C%AC%E4%BF%AE%E5%A4%8D%E8%8A%82%E7%82%B9%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/","excerpt":"","text":"Script to capture and restore file permission in a directory (for eg. ORACLE_HOME) (Doc ID 1515018.1) 问题描述：RAC两个节点中，在节点2执行了chown -R oracle:oinstall /u01 导致节点2 文件权限不对，集群状态异常 解决办法：通过官方提供的 permission.pl 脚本进行修复 校验节点2权限问题 123456789101112# 校验失败，说明权限有异常[grid@rac2 ~]$ cluvfy comp software -n all -verboseVerifying softwareCheck: Software3162 files verifiedSoftware check failedVerification of software was failed. 1节点执行修复脚本 12345678910111213141516# 以root用户执行./permission.pl &lt;Path name to capture permission&gt;[root@rac1 u01]# ./permission.pl /u01/.........Following log files are generatedlogfile : permission-Wed-Jul-07-10-21-13-2021Command file : restore-perm-Wed-Jul-07-10-21-13-2021.cmdLinecount : 62264[root@rac1 u01]# ls -lrttotal 17556drwxrwxr-x. 7 grid oinstall 4096 Jan 27 16:14 softdrwxr-xr-x 6 root oinstall 66 Jan 28 12:34 app-rwxr-xr-x 1 root root 2451 Mar 31 18:08 permission.pl-rw-r--r-- 1 root root 11869417 Jul 7 10:22 restore-perm-Wed-Jul-07-10-21-13-2021.cmd-rw-r--r-- 1 root root 6098198 Jul 7 10:22 permission-Wed-Jul-07-10-21-13-2021 在当前目录下会生成两个文件: a. permission- - This contains file permission in octal value, owner and group information of the files capturedb. restore-perm-.cmd - This contains command to change the permission, owner, and group of the captured files 将生成的两个文件拷贝到2节点 123[root@rac1 u01]# scp permission-Wed-Jul-07-09-41-25-2021 root@rac2:&#x2F;u01[root@rac1 u01]# scp restore-perm-Wed-Jul-07-09-41-25-2021.cmd root@rac2:&#x2F;u01&#x2F; 修改restore-perm-&lt;time stamp&gt;.cmd中的信息 12345678910# 需要修改主机名、数据库实例名、ASM实例名[root@rac2 u01]$ vi restore-perm-Wed-Jul-07-09-41-25-2021.cmd:%s/rac1/rac2/g:%s/racdb1/racdb2/g:%s/ASM1/ASM2/g:%s/asm1/asm2/g# 赋予755权限[root@rac2 u01]# chmod 755 restore-perm-Wed-Jul-07-09-41-25-2021.cmd 以root用户执行restore-perm-&lt;time stamp&gt;.cmd文件 1[root@rac2 u01]# ./restore-perm-Wed-Jul-07-09-41-25-2021.cmd 屏幕输出中会有chown和chmod报错，主要原因为一些日志文件不存在引起 重启主机或集群 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849[grid@rac2 ~]$ crsctl stat res -t--------------------------------------------------------------------------------NAME TARGET STATE SERVER STATE_DETAILS--------------------------------------------------------------------------------Local Resources--------------------------------------------------------------------------------ora.ARCH.dg ONLINE ONLINE rac1 ONLINE ONLINE rac2ora.CRS.dg ONLINE ONLINE rac1 ONLINE ONLINE rac2ora.DATA.dg ONLINE ONLINE rac1 ONLINE ONLINE rac2ora.LISTENER.lsnr ONLINE ONLINE rac1 ONLINE ONLINE rac2ora.asm ONLINE ONLINE rac1 Started ONLINE ONLINE rac2 Startedora.gsd OFFLINE OFFLINE rac1 OFFLINE OFFLINE rac2ora.net1.network ONLINE ONLINE rac1 ONLINE ONLINE rac2ora.ons ONLINE ONLINE rac1 ONLINE ONLINE rac2--------------------------------------------------------------------------------Cluster Resources--------------------------------------------------------------------------------ora.LISTENER_SCAN1.lsnr 1 ONLINE ONLINE rac1ora.cvu 1 ONLINE ONLINE rac1ora.oc4j 1 ONLINE ONLINE rac1ora.rac1.vip 1 ONLINE ONLINE rac1ora.rac2.vip 1 ONLINE ONLINE rac2ora.racdb.db 1 ONLINE ONLINE rac1 Open 2 ONLINE ONLINE rac2 Openora.scan1.vip 1 ONLINE ONLINE rac1[grid@rac2 ~]$ 总结权限修复成功的前提是必须有一个节点的权限是正常的，否则无法通过此方式进行修复","categories":[{"name":"ORACLE","slug":"ORACLE","permalink":"http://coveyzy.vip/categories/ORACLE/"}],"tags":[{"name":"RAC","slug":"RAC","permalink":"http://coveyzy.vip/tags/RAC/"},{"name":"修复","slug":"修复","permalink":"http://coveyzy.vip/tags/%E4%BF%AE%E5%A4%8D/"}]}],"categories":[{"name":"DataGuard","slug":"DataGuard","permalink":"http://coveyzy.vip/categories/DataGuard/"},{"name":"ORACLE","slug":"ORACLE","permalink":"http://coveyzy.vip/categories/ORACLE/"}],"tags":[{"name":"Oracle DataGuard","slug":"Oracle-DataGuard","permalink":"http://coveyzy.vip/tags/Oracle-DataGuard/"},{"name":"RAC","slug":"RAC","permalink":"http://coveyzy.vip/tags/RAC/"},{"name":"修复","slug":"修复","permalink":"http://coveyzy.vip/tags/%E4%BF%AE%E5%A4%8D/"}]}